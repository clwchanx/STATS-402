---
title: "hwk3 pt4"
output: html_document
date: "2024-12-05"
---





```{r}
df <-  read.csv("~/Downloads/diabetic.csv")
head(df)

df$TotalRiskFactors = factor(ifelse(df$TotalRiskFactors == 0, "none", 
                               ifelse(df$TotalRiskFactors == 1, "one", "2 or more")), levels = c("none","one","2 or more"))

# b)
df$Diabetes.new = ifelse(df$Diabetes.new == 0, "no", "yes")

# c)
df$SmokingStatus_NISTCode = factor(df$SmokingStatus_NISTCode, 
                                     levels = c("FALSE", "FORMER", "TRUE"))

# d) 
df$age.new = factor(df$age.new, levels = c("low", "medium", "high"))

```

```{r}
# 2) 
valid_columns = c('TotalRiskFactors', 'Diabetes.new', 'HypertensionDX', 'SmokingStatus_NISTCode')
valid_columns = valid_columns[valid_columns %in% colnames(df)]

if (length(valid_columns) == 0) {
  stop('None of the specified predictor columns exist in the dataset.')
}

levels_info = sapply(df[, valid_columns, drop = FALSE], function(x) length(unique(x)))

print(levels_info)
for (col in names(levels_info)) {
  if (levels_info[col] == 1) {
    cat(sprintf( col))
    df[[col]] = NULL
  }
}
library(nnet)
predictors = valid_columns[valid_columns %in% colnames(df)]
formula = as.formula(paste('age.new ~', paste(predictors, collapse = ' + ')))
model = multinom(formula, data = df)

```
```{r}
(coef <- summary(model)$coefficients)
(intv <- exp(confint(model)))
z <-summary(model)$coefficients/summary(model)$standard.errors
(p <- (1 - pnorm(abs(z), 0, 1))*2)

t1 <- cbind("log odds" = coef["medium",],odds = exp(coef["medium",]),intv[,,"medium"],"p-value" = p['medium',])[-1,]
t2 <- cbind("log odds" = coef["high",],odds = exp(coef["high",]),intv[,,"high"],"p-value" =p['high',])[-1,]
```
```{r}
as.data.frame(t1)
as.data.frame(t2)
```
